<!DOCTYPE html>
<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml" lang="ru">
<head>
    <style>
        .d {
            display: inline-block;
            width: 100px;
            height: 40px;
            background: #b2dba1;
            border: 1px solid gray;
            margin: 5px;
        }
    </style>
</head>
<body>
<div>
    <button onclick="tmsSign.getInstance().execute('red');">button 1</button>
    <button  onclick="tmsSign.getInstance().execute('green');">button 2</button>
    <button>button 3</button>
</div>
<div>
    <div id="d1" class="d">1</div>
    <div id="d2" class="d">2</div>
    <div id="d3" class="d">3</div>
</div>


<script>

    var tmsSign = (function () {
        var tmsSignInstance;

        var createTmsSignInstance = function () {
            var SIGNALS = [];


            var tmsSignall = function () {
                /**
                 *  массив слотов
                 */
                var SLOTS = [];

                /**
                 *  ID слота
                 */
                var ID = null;

                /**
                 * Устанавливает ID слота
                 */
                this.setID = function (id) {
                    if (id === undefined || id === null || id == '')return false;

                    ID = id;
                    return true;
                }

                /**
                 * Возвраает Id слота
                 * @return string
                 */
                this.getId = function () {
                    return ID;
                }

                /**
                 * Возвращает позицию слота в списке слотов
                 * @return int or False
                 */
                this.getSlotPosition = function (slot) {
                    if (slot === undefined || slot == '')return false;

                    var n = SLOTS.length;
                    for (i = 0; i < n; i++) {
                        if (SLOTS[i].slot !== undefined && SLOTS[i].slot == slot) {
                            return i;
                        }
                    }
                    return false;
                }

                /**
                 * делает попытку удалить слот
                 * @return boolean
                 */
                this.removeSlot = function (slot) {
                    if (slot === undefined || slot == '')return false;
                    var pos = this.getSlotPosition(slot);
                    if (pos !== false) {
                        SLOTS.splice(pos, 1);
                    }
                    return true;
                }

                /**
                 * Делает поптыку вернуть слот
                 * @return {}
                 */
                this.getSlot = function (slot) {
                    if (slot === undefined || signall == '')return false;
                    var pos = this.getSlotPosition(slot);
                    if (pos !== false) {
                        return SLOTS[pos];
                    }
                    return false;
                }

                /**
                 * Делает поптыку создать слот или пересоздать
                 * @return boolean
                 */
                this.setSlot = function (slot, action) {
                    if (slot === undefined || slot == '')return false;
                    if (action === undefined || action == '')return false;

                    this.removeSlot(slot);

                    SLOTS.push({slot: slot, action: action});
                    return true;

                }

                /**
                 * Делает попытку выполнить все действия слота
                 */
                this.execute = function () {
                    try {
                        var n = SLOTS.length;
                        for (var i = 0; i < n; i++) {
                            SLOTS[i].action();
                        }
                    } catch (exception_var) {
                    }
                }


            }

            /**
             * Делает попытку исполнить сигнал
             * @param string signall
             */
            this.execute = function(signall){
                var s= this.getSignall(signall);
                if(s===false)return false;
                s.execute();
            }

            this.appendSignall = function(params){
                if(params === undefined)return false;
                if(params.id ===undefined || params.id=='')return false;

                s = this.setSignall(params.id);

                if(params.slots!==undefined){
                    n = params.slots.length;
                    for(i=0;i<n;i++){
                        if(params.slots[i].id!==undefined && params.slots[i].id!='' && params.slots[i].action!==undefined){
                            s.setSlot(params.slots[i].id, params.slots[i].action);
                        }
                    }
                }
            }

            /**
             * Делает попытку вернуть сигналл по его сигнатуре
             * @param string signall
             * @return {} or false
             */
            this.setSignall = function (signall) {
                if (signall === undefined || signall == '')return false;

                this.removeSignall(signall);

                s = new tmsSignall();
                s.setID(signall)
                SIGNALS.push(s);
                return s;

            }

            /**
             * Делает попытку вернуть суть сигнала
             * @param string signall
             * @returns {signall, action} or False
             */
            this.getSignall = function (signall) {
                if (signall === undefined || signall == '')return false;
                var pos = this.getSignalPosition(signall);
                if (pos !== false) {
                    return SIGNALS[pos];
                }
                return false;
            }

            /**
             *  Делает попытку удалить сигнал по его сигнатуре
             *  @param string signal
             *  @return boolean
             */
            this.removeSignall = function (signall) {
                if (signall === undefined || signall == '')return false;
                var pos = this.getSignalPosition(signall);
                if (pos !== false) {
                    SIGNALS.splice(pos, 1);
                }
                return true;
            }

            /**
             * Возвращает позицию сигнала в списке сигналов по его сигнатуре
             * @param string signall
             * @returns int or False
             */
            this.getSignalPosition = function (signall) {
                if (signall === undefined || signall == '')return false;

                var n = SIGNALS.length;
                for (i = 0; i < n; i++) {
                    if (SIGNALS[i].getId() !== undefined && SIGNALS[i].getId() == signall) {
                        return i;
                    }
                }
                return false;
            }

            return this;
        };

        return {
            getInstance: function () {
                if (!tmsSignInstance) {
                    tmsSignInstance = createTmsSignInstance();
                }
                return tmsSignInstance;
            }
        };
    })();

</script>

<script>

    inst1 = tmsSign.getInstance();

    red_sign = inst1.setSignall('red');
    red_sign.setSlot('act1', function(){document.getElementById('d1').innerText = 'act1';})
    red_sign.setSlot('act2', function(){document.getElementById('d2').innerText = 'act2';})
    red_sign.setSlot('act3', function(){document.getElementById('d3').innerText = 'act3';})

    green_signal = {
        id: 'green'
        ,slots: [
            {id: 'green_act1', action : function(){document.getElementById('d1').innerText = 'green act1';} }
            ,{id: 'green_act2', action : function(){document.getElementById('d2').innerText = 'green act2';} }
            ,{id: 'green_act3', action : function(){document.getElementById('d3').innerText = 'green act3';} }
        ]
    }

    tmsSign.getInstance().appendSignall(green_signal);




</script>
</body>
</html>
